<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ Quy đổi các phương thức Bách khoa</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and rounded corners */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fef2f2; /* Light red background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            padding: 32px;
            border-radius: 16px; /* Rounded corners for the main container */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #b91c1c; /* Dark red text */
        }
        .input-group label {
            font-weight: 600;
            color: #b91c1c; /* Dark red text */
            margin-bottom: 8px;
            display: block;
        }
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ef4444; /* Red border */
            border-radius: 8px; /* Rounded corners for inputs/selects */
            font-size: 16px;
            color: #475569;
            box-sizing: border-box; /* Ensures padding doesn't affect total width */
        }
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #dc2626; /* Red focus border */
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2); /* Red shadow on focus */
        }
        .button-primary {
            background-color: #dc2626; /* Red button */
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px; /* Rounded corners for button */
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            width: 100%;
        }
        .button-primary:hover {
            background-color: #b91c1c; /* Darker red on hover */
        }
        .result-box {
            background-color: #fee2e2; /* Lighter red background for result */
            border-left: 5px solid #dc2626; /* Red border */
            padding: 16px;
            border-radius: 8px; /* Rounded corners for result box */
            margin-top: 24px;
            font-size: 1.15em;
            font-weight: 600;
            color: #b91c1c; /* Dark red text */
        }
        .warning-message {
            color: #ef4444; /* Red warning text */
            font-size: 0.9em;
            margin-top: 16px;
            text-align: center;
        }
        .disabled-option {
            color: #94a3b8;
        }
        .disabled-select {
            background-color: #f3f4f6;
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-2 text-red-700">Công cụ Quy đổi các phương thức Bách khoa</h1>
        <p class="text-center text-gray-600 mb-8">Made by HowdeepTry</p>

        <div class="mb-6 input-group">
            <label for="input_type">Chọn phương thức đầu vào:</label>
            <select id="input_type" name="input_type" required class="rounded-lg">
                <option value="xttn_1_2">XTTN diện 1.2</option>
                <option value="xttn_1_3">XTTN diện 1.3</option>
                <option value="dgtd">ĐGTD (bao gồm cả TSA)</option>
            </select>
        </div>

        <div class="mb-6 input-group">
            <label for="score" id="score_label">Điểm đầu vào:</label>
            <input type="text" id="score" name="score" placeholder="Ví dụ: 80" required class="rounded-lg">
        </div>

        <div id="ielts_section" class="mb-6 input-group hidden">
            <label for="ielts_score">Điểm IELTS (Academic):</label>
            <select id="ielts_score" name="ielts_score" class="rounded-lg">
                <option value="0">Không có IELTS</option>
                <option value="1">5.0 (Thưởng 1 điểm)</option>
                <option value="2">5.5 (Thưởng 2 điểm)</option>
                <option value="3">6.0 (Thưởng 3 điểm)</option>
                <option value="4">6.5 (Thưởng 4 điểm)</option>
                <option value="5">7.0 (Thưởng 5 điểm)</option>
                <option value="6">7.5 (Thưởng 6 điểm)</option>
                <option value="7">≥ 8.0 (Thưởng 7 điểm)</option>
            </select>
        </div>

        <div class="mb-8 input-group">
            <label for="priority_area">Chọn khu vực ưu tiên:</label>
            <select id="priority_area" name="priority_area" required class="rounded-lg">
                <option value="none">Không ưu tiên</option>
                <option value="kv1">Khu vực 1 (+0.75 điểm)</option>
                <option value="kv2_nong_thon">Khu vực 2 nông thôn (+0.5 điểm)</option>
                <option value="kv2">Khu vực 2 (+0.25 điểm)</option>
            </select>
        </div>

        <button onclick="performConversion()" class="button-primary rounded-lg">Quy đổi</button>

        <div id="result" class="result-box hidden">
            <!-- Kết quả sẽ hiển thị ở đây -->
        </div>

        <div class="warning-message">
            *Lưu ý: Điểm ưu tiên được tính theo công thức mới. XTTN 1.2 và 1.3 không cộng điểm ưu tiên.
        </div>
    </div>

    <script>
        // Dữ liệu quy đổi từ các phương thức đầu vào
        // Các phương thức này quy đổi từ thang 100 sang thang 30 (Tổ hợp A00)
        const CONVERSION_DATA = {
            'xttn_1_2': { // XTTN diện 1.2 (input: thang 100) -> Output: THPT (thang 30)
                label: "Điểm XTTN diện 1.2 (thang 100):",
                outputLabel: "Điểm THPT tương ứng (thang 30):",
                hasPriority: false, // XTTN 1.2 does NOT apply priority points
                hasIELTS: false, // No IELTS bonus for XTTN 1.2
                ranges: [ // Data for A00 (Tổ hợp A00)
                    { a: 91.61, b: 100, c: 29.25, d: 30 },
                    { a: 78.50, b: 91.61, c: 28.46, d: 29.25 },
                    { a: 72.88, b: 78.50, c: 27.55, d: 28.46 },
                    { a: 55, b: 72.88, c: 25.08, d: 27.55 }
                ]
            },
            'xttn_1_3': { // XTTN diện 1.3 (input: thang 100) -> Output: THPT (thang 30)
                label: "Điểm XTTN diện 1.3 (thang 100):",
                outputLabel: "Điểm THPT tương ứng (thang 30):",
                hasPriority: false, // XTTN 1.3 does NOT apply priority points
                hasIELTS: false, // No IELTS bonus for XTTN 1.3
                ranges: [ // Data for A00 (Tổ hợp A00)
                    { a: 94.64, b: 100, c: 29.25, d: 30 },
                    { a: 85.20, b: 94.64, c: 28.46, d: 29.25 },
                    { a: 66.57, b: 85.20, c: 27.55, d: 28.46 },
                    { a: 55, b: 66.57, c: 25.08, d: 27.55 }
                ]
            },
            'dgtd': { // ĐGTD (input: thang 100) -> Output: THPT (thang 30) - This now includes TSA logic
                label: "Điểm ĐGTD/TSA (thang 100):",
                outputLabel: "Điểm quy đổi (ĐGTD/TSA) tương ứng (thang 30):",
                hasPriority: true, // ĐGTD/TSA applies priority points
                hasIELTS: true, // ĐGTD/TSA applies IELTS bonus
                ranges: [ // Data for A00 (Tổ hợp A00)
                    { a: 83.98, b: 100, c: 29.25, d: 30 },
                    { a: 76.23, b: 83.98, c: 28.46, d: 29.25 },
                    { a: 69.88, b: 76.23, c: 27.55, d: 28.46 },
                    { a: 59.71, b: 69.88, c: 25.08, d: 27.55 },
                    { a: 55.22, b: 59.71, c: 23.46, d: 25.08 },
                    { a: 46.95, b: 55.22, c: 19.5, d: 23.46 }
                ]
            }
        };

        // Mức điểm ưu tiên cơ bản theo khu vực
        const PRIORITY_POINTS = {
            'none': 0,
            'kv1': 0.75,
            'kv2_nong_thon': 0.5,
            'kv2': 0.25
        };

        // Điểm thưởng IELTS
        const IELTS_BONUS_VALUES = {
            '0': 0, // Không có IELTS
            '1': 1, // IELTS 5.0
            '2': 2, // IELTS 5.5
            '3': 3, // IELTS 6.0
            '4': 4, // IELTS 6.5
            '5': 5, // IELTS 7.0
            '6': 6, // IELTS 7.5
            '7': 7  // IELTS >= 8.0
        };

        function calculateConversion(x, inputType) {
            /**
             * Tính điểm quy đổi từ điểm đầu vào (x) sang điểm THPT (thang 30)
             * dựa trên công thức y = c + ((x-a)/(b-a)) * (d-c)
             */
            if (CONVERSION_DATA[inputType] && CONVERSION_DATA[inputType].ranges.length > 0) {
                const ranges = CONVERSION_DATA[inputType].ranges;
                for (const { a, b, c, d } of ranges) {
                    const epsilon = 0.0001;
                    if ((x >= a - epsilon && x <= b + epsilon) || (x > b && a === Math.max(...ranges.map(r => r.a)))) {
                        if (Math.abs(b - a) < epsilon) {
                            return c;
                        }
                        const y = c + ((x - a) / (b - a)) * (d - c);
                        return Math.round(y * 1000) / 1000;
                    }
                }
                return "Không tìm thấy khoảng điểm phù hợp để quy đổi.";
            } else {
                return "Dữ liệu quy đổi cho phương thức này chưa có.";
            }
        }

        function getIELTSBonus(ieltsBandValue) {
            return IELTS_BONUS_VALUES[ieltsBandValue] || 0;
        }

        function performConversion() {
            const scoreInput = document.getElementById('score');
            const inputTypeSelect = document.getElementById('input_type');
            const priorityAreaSelect = document.getElementById('priority_area');
            const ieltsScoreSelect = document.getElementById('ielts_score');
            const resultDiv = document.getElementById('result');

            let score = parseFloat(scoreInput.value);
            const inputType = inputTypeSelect.value;
            const priorityArea = priorityAreaSelect.value;
            const ieltsBandValue = ieltsScoreSelect.value;

            // Hide old results
            resultDiv.classList.add('hidden');
            resultDiv.innerHTML = '';

            if (isNaN(score)) {
                resultDiv.innerHTML = "Vui lòng nhập một số hợp lệ cho điểm.";
                resultDiv.classList.remove('hidden');
                return;
            }

            let bonusPoints = 0;
            let priorityPointsOn100Scale = 0;
            let scoreBefore30PointConversion = score; // This will be the score after adding IELTS bonus and priority (on 100-point scale)
            let convertedScore = 0; // This will be the score on the 30-point scale
            let finalTotalScore = 0; // This will be the 30-point score after all calculations
            let outputLabel = CONVERSION_DATA[inputType].outputLabel;

            let resultHtml = ``;

            // Apply IELTS bonus if the selected method has it (currently only DGTD)
            if (CONVERSION_DATA[inputType].hasIELTS) {
                bonusPoints = getIELTSBonus(ieltsBandValue);
                scoreBefore30PointConversion = score + bonusPoints;
                resultHtml += `
                    <p>Điểm thi ban đầu: <strong>${score}</strong></p>
                    <p>Điểm thưởng IELTS: <strong>${bonusPoints}</strong></p>
                    <p>Điểm sau thưởng: <strong>${scoreBefore30PointConversion}</strong></p>
                `;
            } else {
                resultHtml += `<p>Điểm đầu vào: <strong>${score}</strong></p>`;
            }

            // Calculate priority points on 100-point scale for DGTD
            if (CONVERSION_DATA[inputType].hasPriority && inputType === 'dgtd') {
                const basePriority = PRIORITY_POINTS[priorityArea];
                // Apply priority directly to scoreBefore30PointConversion (which is on 100-point scale)
                // The formula for DGTD is "Điểm dgtd + Điểm thưởng + điểm ưu tiên*10/3"
                priorityPointsOn100Scale = basePriority * (100 / 30); // Convert 30-point priority to 100-point scale
                scoreBefore30PointConversion += priorityPointsOn100Scale;

                if (priorityArea !== 'none') {
                    resultHtml += `
                        <p>Điểm ưu tiên (${priorityArea.toUpperCase()}) trên thang 100: <strong>${Math.round(priorityPointsOn100Scale * 1000) / 1000}</strong></p>
                        <p>Tổng điểm (ĐGTD/TSA + Thưởng + Ưu tiên) trên thang 100: <strong>${Math.round(scoreBefore30PointConversion * 1000) / 1000}</strong></p>
                    `;
                }
            } else if (priorityArea !== 'none' && !CONVERSION_DATA[inputType].hasPriority) {
                 resultHtml += `<p class="text-red-500">Phương thức này không được cộng điểm ưu tiên.</p>`;
            }


            // Convert score to 30-point scale
            convertedScore = calculateConversion(scoreBefore30PointConversion, inputType);

            if (typeof convertedScore !== 'number') { // Check if conversion was successful (returned a number)
                resultDiv.innerHTML = `Lỗi quy đổi: ${convertedScore}`; // Display error message from conversion
                resultDiv.classList.remove('hidden');
                return;
            }

            finalTotalScore = convertedScore; // All additions already happened on 100-point scale and then converted

            resultHtml += `
                <p>${outputLabel} <strong>${convertedScore}</strong></p>
            `;

            resultDiv.innerHTML = resultHtml;
            resultDiv.classList.remove('hidden');
        }

        // Update input score label, placeholder, and section visibility
        function updateInputFields() {
            const selectedType = document.getElementById('input_type').value;
            const scoreLabel = document.getElementById('score_label');
            const scoreInput = document.getElementById('score');
            const ieltsSection = document.getElementById('ielts_section');
            const priorityAreaSelect = document.getElementById('priority_area');

            scoreLabel.textContent = CONVERSION_DATA[selectedType].label;
            scoreInput.placeholder = "Ví dụ: 80 (thang 100)"; // All remaining inputs are thang 100

            // Show/hide IELTS section based on hasIELTS property for the selected type
            if (CONVERSION_DATA[selectedType].hasIELTS) {
                ieltsSection.classList.remove('hidden');
            } else {
                ieltsSection.classList.add('hidden');
            }

            // Enable/disable priority area select based on hasPriority property
            if (CONVERSION_DATA[selectedType].hasPriority) {
                priorityAreaSelect.classList.remove('disabled-select');
                priorityAreaSelect.disabled = false;
            } else {
                priorityAreaSelect.classList.add('disabled-select');
                priorityAreaSelect.disabled = true;
            }
        }

        document.getElementById('input_type').addEventListener('change', updateInputFields);

        // Initialize fields on page load
        document.addEventListener('DOMContentLoaded', updateInputFields);
    </script>
</body>
</html>

